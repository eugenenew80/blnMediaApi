<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd">

    <changeSet id="media-eug-78" logicalFilePath="path-independent" author="eugene" context="postgres">
        <dropColumn columnName="header" schemaName="apps" tableName="media_doc_metering_reading_headers"/>
        <rollback>
            <addColumn schemaName="apps" tableName="media_doc_metering_reading_headers">
                <column name="header" type="varchar(300)"/>
            </addColumn>
        </rollback>
    </changeSet>

    <changeSet id="media-eug-79" logicalFilePath="path-independent" author="eugene" context="postgres">
        <dropColumn columnName="header" schemaName="apps" tableName="media_doc_meter_replacing_headers"/>
        <rollback>
            <addColumn schemaName="apps" tableName="media_doc_meter_replacing_headers">
                <column name="header" type="varchar(300)"/>
            </addColumn>
        </rollback>
    </changeSet>

    <changeSet id="media-eug-80" logicalFilePath="path-independent" author="eugene" context="postgres">
        <dropColumn columnName="header" schemaName="apps" tableName="media_doc_under_accounting_headers"/>
        <rollback>
            <addColumn schemaName="apps" tableName="media_doc_under_accounting_headers">
                <column name="header" type="varchar(300)"/>
            </addColumn>
        </rollback>
    </changeSet>

    <changeSet id="media-eug-81" logicalFilePath="path-independent" author="eugene" context="postgres">
        <modifyDataType
            columnName="start_date"
            newDataType="TIMESTAMP WITHOUT TIME ZONE"
            schemaName="apps"
            tableName="media_doc_metering_reading_headers"/>

        <rollback/>
    </changeSet>

    <changeSet id="media-eug-82" logicalFilePath="path-independent" author="eugene" context="postgres">
        <modifyDataType
            columnName="end_date"
            newDataType="TIMESTAMP WITHOUT TIME ZONE"
            schemaName="apps"
            tableName="media_doc_metering_reading_headers"/>

        <rollback/>
    </changeSet>

    <changeSet id="media-eug-83" logicalFilePath="path-independent" author="eugene" context="postgres">
        <dropColumn columnName="template_id" schemaName="apps" tableName="media_doc_metering_reading_headers"/>
        <rollback>
            <addColumn schemaName="apps" tableName="media_doc_metering_reading_headers">
                <column name="template_id" type="number"/>
            </addColumn>
        </rollback>
    </changeSet>


    <changeSet id="media-eug-84" logicalFilePath="path-independent" author="eugene" context="postgres">
        <addColumn schemaName="apps" tableName="media_doc_metering_reading_headers">
            <column name="doc_date" type="date">
                <constraints nullable="false" />
            </column>
        </addColumn>

        <addColumn schemaName="apps" tableName="media_doc_metering_reading_headers">
            <column name="doc_type_id" type="number">
                <constraints nullable="false" />
            </column>
        </addColumn>

        <addColumn schemaName="apps" tableName="media_doc_metering_reading_headers">
            <column name="group_id" type="number">
                <constraints nullable="false" />
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="media-eug-85" logicalFilePath="path-independent" author="eugene" context="postgres">
        <dropTable schemaName="apps" tableName="media_doc_templates"/>
        <dropSequence sequenceName="media_doc_templates_s" schemaName="apps" />

        <rollback>
            <createTable tableName="media_doc_templates" schemaName="apps">
                <column name="id" type="number">
                    <constraints nullable="false"/>
                </column>

                <column name="doc_type_id" type="number">
                    <constraints nullable="false"/>
                </column>

                <column name="name" type="varchar(100)">
                    <constraints nullable="false"/>
                </column>

                <column name="header" type="varchar(300)">
                    <constraints nullable="true"/>
                </column>

                <column name="group_id" type="number">
                    <constraints nullable="false"/>
                </column>
            </createTable>

            <createSequence
                    incrementBy="1"
                    schemaName="apps"
                    sequenceName="media_doc_templates_s"
                    startValue="2"/>

            <loadData
                    encoding="UTF-8"
                    relativeToChangelogFile="true"
                    file="data/media_doc_templates.csv"
                    quotchar="'"
                    schemaName="apps"
                    separator=";"
                    tableName="media_doc_templates">

                <column name="id" 			type="NUMERIC"/>
                <column name="doc_type_id" 	type="NUMERIC"/>
                <column name="name"			type="STRING"/>
                <column name="header"		type="STRING"/>
                <column name="group_id" 	type="NUMERIC"/>
            </loadData>
        </rollback>
    </changeSet>

    <changeSet id="media-eug-86" logicalFilePath="path-independent" author="eugene" context="postgres">
        <dropColumn columnName="oper_date" schemaName="apps" tableName="media_doc_metering_reading_lines"/>
        <rollback>
            <addColumn schemaName="apps" tableName="media_doc_metering_reading_lines">
                <column name="oper_date" type="date"/>
            </addColumn>
        </rollback>
    </changeSet>

</databaseChangeLog>
